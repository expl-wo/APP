(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-equip-equipCheck-checkItem"],{"02f6":function(e,t,i){"use strict";i.r(t);var a=i("1ca1"),s=i.n(a);for(var n in a)["default"].indexOf(n)<0&&function(e){i.d(t,e,(function(){return a[e]}))}(n);t["default"]=s.a},"0c9f":function(e,t,i){"use strict";i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return n})),i.d(t,"a",(function(){return a}));var a={uInput:i("38ad").default,uUpload:i("4dfe").default},s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"content"},[i("v-uni-view",{staticClass:"hp app-containerC"},[i("v-uni-view",{staticClass:"app-containerR navbar"},[i("v-uni-view",{staticClass:"titleCls"},[e._v("设备名称:"+e._s(e.eqpName)+";设备ID:"+e._s(e.eqpId)+";\n\t\t\t\t使用部门:"+e._s(e.usingDepName)+";待点检项：")]),i("v-uni-button",{staticClass:"andonButton",attrs:{type:"primary",size:"mini"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.andonButtonClick.apply(void 0,arguments)}}},[e._v("Andon")])],1),i("v-uni-view",{staticClass:"app-containerC wp table-zdy"},[i("v-uni-view",{staticClass:"th-group"},[i("v-uni-view",{staticClass:"th"},[e._v("步骤")]),i("v-uni-view",{staticClass:"th"},[e._v("点检项类型")]),i("v-uni-view",{staticClass:"th"},[e._v("点检名称")]),i("v-uni-view",{staticClass:"th"},[e._v("点检内容")]),i("v-uni-view",{staticClass:"th"},[e._v("点检值")]),i("v-uni-view",{staticClass:"th"},[e._v("单位")]),i("v-uni-view",{staticClass:"th"},[e._v("文字记录")]),i("v-uni-view",{staticClass:"th"},[e._v("操作")]),i("v-uni-view",{staticClass:"th"},[e._v("是否合格")]),i("v-uni-view",{staticClass:"th"},[e._v("不合格描述")])],1),e._l(e.spotCheckItemSData,(function(t,a){return i("v-uni-view",{key:t.id,staticClass:"td-group"},[i("v-uni-view",{staticClass:"td"},[e._v(e._s(t.step))]),i("v-uni-view",{staticClass:"td"},[i("v-uni-view",{class:e.changeClass(t.itemCategory)},[e._v(e._s(e.changeType(t.itemCategory)))])],1),i("v-uni-view",{staticClass:"td"},[e._v(e._s(t.name))]),i("v-uni-view",{staticClass:"td"},[e._v(e._s(t.description))]),i("v-uni-view",{staticClass:"td"},[i("u-input",{attrs:{"input-align":"center",disabled:t.disabled,placeholder:t.placeholderValue,type:"text"},model:{value:t.spotValue,callback:function(i){e.$set(t,"spotValue",i)},expression:"item.spotValue"}})],1),i("v-uni-view",{staticClass:"td"},[e._v(e._s(t.unit))]),i("v-uni-view",{staticClass:"td"},[1==t.needText?i("u-input",{attrs:{height:40,"placeholder-style":"font-size: 12px;",type:"textarea"},model:{value:t.record,callback:function(i){e.$set(t,"record",i)},expression:"item.record"}}):e._e()],1),i("v-uni-view",{staticClass:"td"},[1===t.needPhoto?i("v-uni-view",{staticClass:"btn app-containerC"},[i("u-upload",{attrs:{fileList:e.fileList[a],name:"1",accept:"image",maxCount:1,previewFullImage:!0},on:{afterRead:function(i){arguments[0]=i=e.$handleEvent(i),e.afterRead(i,t,a)},delete:function(i){arguments[0]=i=e.$handleEvent(i),e.deletePic(i,t,a)}}})],1):e._e()],1),i("v-uni-view",{staticClass:"td"},[i("v-uni-radio-group",{on:{change:function(i){arguments[0]=i=e.$handleEvent(i),e.chan(i.detail,t)}},model:{value:t.isError,callback:function(i){e.$set(t,"isError",i)},expression:"item.isError"}},[i("v-uni-radio",{attrs:{value:"1",checked:1==t.isError}},[e._v("是")]),i("v-uni-radio",{attrs:{value:"2",checked:2==t.isError}},[e._v("否")])],1)],1),i("v-uni-view",{staticClass:"td"},[2==t.isError?i("u-input",{attrs:{height:40,"placeholder-style":"font-size: 12px;",type:"textarea"},model:{value:t.errorMsg,callback:function(i){e.$set(t,"errorMsg",i)},expression:"item.errorMsg"}}):e._e()],1)],1)}))],2),i("v-uni-view",{staticClass:"wp app-containerR cc"},[i("v-uni-button",{staticClass:"m-20",attrs:{type:"success",size:"mini"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.saveData.apply(void 0,arguments)}}},[e._v("保存数据")]),i("v-uni-button",{staticClass:"m-20",attrs:{type:"primary",size:"mini"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.submitSpotCheckClick.apply(void 0,arguments)}}},[e._v("提交")]),i("v-uni-button",{staticClass:"m-20",attrs:{size:"mini"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.cancelClick.apply(void 0,arguments)}}},[e._v("取消")])],1)],1)],1)},n=[]},"1ca1":function(e,t,i){"use strict";i("7a82");var a=i("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=a(i("c7eb")),n=a(i("5530")),o=a(i("1da1"));i("d3b7"),i("159b"),i("14d9"),i("acd8"),i("a434"),i("99af"),i("baa5"),i("c975"),i("d81d");var c=i("6980"),r=i("e237"),u=a(i("b841")),p=i("9b6c"),l=i("70f3"),d={data:function(){return{eqpItem:"",eqpId:"",eqpName:"",checkId:"",checkName:"",recId:"",spotCheckItemSData:"",scanId:"",usingDepName:"",scanShow:!1,focus:!1,item:{},fileList:[],title:"chooseVideo",sourceTypeIndex:2,sourceType:["拍摄","相册","拍摄或相册"],src:"",cameraList:[{value:"back",name:"后置摄像头",checked:"true"},{value:"front",name:"前置摄像头"}],cameraIndex:0}},created:function(){this.photoRec={}},onLoad:function(e){var t=this;console.log("进入日常点检"),this.spotCheckItemSData=[],0==e.type?(this.eqpItem=JSON.parse(e.eqpItem),this.eqpId=this.eqpItem.EQPID||this.eqpItem.eqpId,this.eqpName=this.eqpItem.EQPNAME||this.eqpItem.eqpName,this.checkId=this.eqpItem.CHECKID||this.eqpItem.checkId,this.checkName=this.eqpItem.CHECKNAME||this.eqpItem.checkName,this.recId=this.eqpItem.RECID||this.eqpItem.recId,this.usingDepName=this.eqpItem.USINGDEPNAME||this.eqpItem.usingDepName):(this.eqpItem=JSON.parse(e.eqpItem),this.eqpId=this.eqpItem.eqpId,this.eqpName=this.eqpItem.eqpName,this.checkId=this.eqpItem.ckOrMtcId,this.checkName=this.eqpItem.ckOrMtcName,this.recId=this.eqpItem.attribute2,this.usingDepName=this.eqpItem.USINGDEPNAME||this.eqpItem.usingDepName);var i={eqpId:this.eqpId,checkId:this.checkId,recId:this.recId,pg_pagesize:100,pg_pagenum:1};(0,c.getSpotCheckItems)(i).then((function(e){t.recId=e.data.recId,t.spotCheckItemSData=e.data.item,console.log(t.spotCheckItemSData),t.spotCheckItemSData.forEach((function(e){1==e.type?(e.placeholderValue=e.lowerLimit+"|"+e.upperLimit,e.disabled=!1):(e.placeholderValue="常规检查",e.disabled=!0),e.imageToShow?t.fileList.push([{url:(0,l.getFileServerUrl)()+e.imageToShow}]):t.fileList.push([])}))}))},methods:{submitSpotCheckClick:function(){var e=this,t=!0,i=0,a=0;if(this.spotCheckItemSData.forEach((function(e){e.imageToShow||1!==e.needPhoto||(t=!1,i=e.step),""!=e.record&&e.record||1!==e.needText||(t=!1,a=e.step)})),t){var s=[],n=[];if(this.spotCheckItemSData.forEach((function(e){1==e.type&&n.push(e)})),this.spotCheckItemSData.forEach((function(e){1==e.type&&(e.lowerLimit&&e.upperLimit?parseFloat(e.spotValue)>=parseFloat(e.lowerLimit)&&parseFloat(e.spotValue)<=parseFloat(e.upperLimit)||2==e.isError?s.push(e):e.isError=2:!e.lowerLimit&&e.upperLimit?parseFloat(e.spotValue)<=parseFloat(e.upperLimit)||2==e.isError?s.push(e):e.isError=2:e.lowerLimit&&!e.upperLimit&&(parseFloat(e.spotValue)>=parseFloat(e.lowerLimit)||2==e.isError?s.push(e):e.isError=2))})),s.length==n.length)this.submitConsole();else if(s.length>0){n.forEach((function(t){var i=t.step;s.forEach((function(e){i==e.step&&(haveVlue=!0,console.log("step一样",i,e.step))})),(0,p.$confirm)("第"+t.step+"步输入的点检值不在点检值范围内，且结果为通过，将修改结果为不通过，然后请重新提交！").then((function(t){e.$forceUpdate()}))}))}else(0,p.$confirm)("点检值不正确，请输入点检值~").then((function(e){}))}else{var o="";0!=a&&0!=i?o+="第"+i+"步未拍摄操作照片!第"+a+"步未填写文字说明!请核对~":0==a&&0!=i?o+="第"+i+"步未拍摄操作照片!请核对~":0==i&&0!=a&&(o+="第"+a+"步未填写文字说明!请核对~"),(0,p.$confirm)(o).then((function(e){}))}},submitConsole:function(){var e=[];this.spotCheckItemSData.forEach((function(t){e.push({ciId:t.id,ciResult:t.isError,ciStep:t.step,photoPath:t.src,ciValue:t.spotValue||"",record:t.record,isError:t.isError,errorMsg:t.errorMsg})}));var t={recId:this.recId,itemRecList:e};(0,c.spotCheckSubmit)(t).then((function(e){console.log(e),uni.navigateBack()}))},cancelClick:function(){uni.navigateBack()},deletePic:function(e,t,i){t.imageToShow="",this.fileList[i].splice(e.index,1)},afterRead:function(e,t,i){var a=this;return(0,o.default)((0,s.default)().mark((function o(){var c,r,u,p,d,h,f,v;return(0,s.default)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(c=[].concat(e.file),r=["jpg","png","jepg","jpeg","img","gif"],u=!1,c.forEach((function(e){var t=e.name.substring(e.name.lastIndexOf(".")+1);u=-1===r.indexOf(t.toLowerCase())})),!u){s.next=7;break}return uni.showToast({icon:"none",title:"请选择图片"}),s.abrupt("return");case 7:p=a.fileList[i].length,c.map((function(e){a.fileList[i].push((0,n.default)((0,n.default)({},e),{},{status:"uploading",message:"上传中"}))})),d=0;case 10:if(!(d<c.length)){s.next=23;break}return s.next=13,a.uploadFilePromise(c[d].url);case 13:h=s.sent,t.imageToShow=h,f=a.fileList[i][p],a.fileList[i].splice(p,1,Object.assign(f,{status:"success",message:"",url:h})),p++,v=(0,l.getFileServerUrl)()+h,a.fileList[i]=[{url:v}];case 20:d++,s.next=10;break;case 23:case"end":return s.stop()}}),o)})))()},uploadFilePromise:function(e){return new Promise((function(t,i){u.default.upload({token:(0,r.getToken)(),filePath:e}).then((function(e){if(200!==e.code)return t({status:500,msg:"上传失败"});setTimeout((function(){return t(e.data.filePath)}),150)}))}))},scanButtonClick:function(){var e=this;this.scanShow=!0,setTimeout((function(){e.focus=!0}),300)},scanNext:function(e){this.scanId=e.target.value,this.scanShow=!1,this.chooseOneItemScan()},chooseOneItemScan:function(){var e=this;this.spotCheckItemSData.forEach((function(t){t.id==e.scanId&&(t.primary="primary")})),this.scanId="",this.focus=!1},chan:function(e,t){t.isError=e.value,console.log(this.spotCheckItemSData)},andonButtonClick:function(){var e={type:1,eqpId:this.eqpItem.eqpId,eqpName:this.eqpItem.eqpName,checkId:this.eqpItem.checkId,checkName:this.eqpItem.checkName,recId:this.eqpItem.recId};getApp().globalData.andonData=e,uni.navigateTo({url:"/pages/andon/andon_002_class?cateId=20201126110459233511001176750837&&type=8"});var t=getApp().globalData.andonData;console.log(t,"dd")},takePhoto:function(e){this.item=e},previewImg:function(e){console.log("logUrl",e);var t=[];t[0]=e,uni.previewImage({current:0,urls:t})},changeType:function(e){return 0==e?"安全部位类":1==e?"核心部位类":"其他"},changeClass:function(e){return 0==e?"color-0":1==e?"color-1":"color-2"},saveData:function(){var e=[];this.spotCheckItemSData.forEach((function(t){e.push({ciId:t.id,ciResult:t.isError,ciStep:t.step,photoPath:t.imageToShow,ciValue:t.spotValue||"",record:t.record,isError:t.isError,errorMsg:t.errorMsg})}));var t={recId:this.recId,itemRecList:e};(0,c.keepCheckRec)(t).then((function(e){uni.navigateBack()}))}}};t.default=d},"3ab2":function(e,t,i){var a=i("24fb");t=a(!1),t.push([e.i,".spotCheckButtonShow[data-v-072d1e0f]{margin:0;height:35px;font-size:14px}.titleCls[data-v-072d1e0f]{color:#0081ff;font-size:20px;margin-left:20px;margin-top:15px}.scanButton[data-v-072d1e0f]{margin-bottom:10px;margin-left:3px;font-size:12px}.andonButton[data-v-072d1e0f]{margin-top:15px;margin-right:20px;font-size:13px}.navbar[data-v-072d1e0f]{display:flex;flex-direction:row;justify-content:space-between;margin-bottom:10px}.td-relative[data-v-072d1e0f]{flex:1;overflow:auto;border-top:1px solid #e4e7ed;border-right:1px solid #e4e7ed;border-left:1px solid #e4e7ed;border-bottom:1px solid #e4e7ed;padding:5px;display:flex;align-items:center;align-content:center;justify-content:center;position:relative;z-index:1}.video[data-v-072d1e0f]{position:relative}.img-cover[data-v-072d1e0f]{position:absolute;width:%?30?%;height:%?30?%;z-index:999}.color-0[data-v-072d1e0f]{color:#ed1c24}.color-1[data-v-072d1e0f]{color:#05f}.color-2[data-v-072d1e0f]{color:#000}",""]),e.exports=t},6980:function(e,t,i){"use strict";i("7a82");var a=i("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.getOtherSpotCheckList=function(e){return(0,s.default)({url:"/pbequipment/equipCheck/othercheck",method:"get",data:e})},t.getProSpotCheckList=function(e){return(0,s.default)({url:"/pbequipment/equipCheck/proCheck",method:"get",data:e})},t.getSpotCheckItems=function(e){return(0,s.default)({url:"/pbequipment/equipCheck/opInit",method:"get",data:e})},t.keepCheckRec=function(e){return(0,s.default)({url:"/pbequipment/equipCheck/keepCheckRec",method:"post",data:e})},t.spotCheckSubmit=function(e){return(0,s.default)({url:"/pbequipment/equipCheck/checkSubmit",method:"post",data:e})};var s=a(i("3d7c"))},8738:function(e,t,i){var a=i("3ab2");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var s=i("4f06").default;s("97c26ef2",a,!0,{sourceMap:!1,shadowMode:!1})},"9d53":function(e,t,i){"use strict";i.r(t);var a=i("0c9f"),s=i("02f6");for(var n in s)["default"].indexOf(n)<0&&function(e){i.d(t,e,(function(){return s[e]}))}(n);i("ecaa");var o=i("f0c5"),c=Object(o["a"])(s["default"],a["b"],a["c"],!1,null,"072d1e0f",null,!1,a["a"],void 0);t["default"]=c.exports},ecaa:function(e,t,i){"use strict";var a=i("8738"),s=i.n(a);s.a}}]);